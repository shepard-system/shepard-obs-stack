groups:
  - name: services
    rules:
      - alert: HighToolErrorRate
        expr: |
          (
            sum(rate(shepherd_tool_calls_total{tool_status="error"}[5m]))
            /
            sum(rate(shepherd_tool_calls_total[5m]))
          ) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High tool error rate across all sources"
          description: "Tool error rate is above 10%. Current: {{ $value | humanizePercentage }}"

      - alert: NoTelemetryReceived
        expr: |
          sum by (receiver) (rate(otelcol_receiver_accepted_spans{transport="grpc"}[10m])) == 0
          and
          sum by (receiver) (rate(otelcol_receiver_accepted_metric_points{transport="grpc"}[10m])) == 0
        for: 10m
        labels:
          severity: info
        annotations:
          summary: "No telemetry received on {{ $labels.receiver }}"
          description: "No spans or metrics received on receiver {{ $labels.receiver }} for 10 minutes."
